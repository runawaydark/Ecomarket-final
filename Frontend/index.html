<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ============================================
        CONFIGURACI√ìN B√ÅSICA DEL DOCUMENTO
    ============================================ -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoMarket ‚Äî Frutas y Verduras</title>
    
    <!-- ============================================
        ESTILOS EXTERNOS
    ============================================ -->
    <!-- Bootstrap CSS Framework -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Iconos de Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Estilos personalizados del proyecto -->
    <link href="assets/css/style.css" rel="stylesheet">
    
    <!-- Font Awesome para iconos adicionales -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- ============================================
        ESTILOS ESPEC√çFICOS DE LA P√ÅGINA PRINCIPAL
    ============================================ -->
    <style>
        /* Estilos para tarjetas de productos destacados */
        .featured-product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .featured-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }
        
        /* Badge animado para ofertas especiales */
        .offer-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            font-weight: bold;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
        }
        
        /* Animaci√≥n de pulso para badges de ofertas */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Estilos para precios originales tachados */
        .price-original {
            font-size: 0.9rem;
            color: #6c757d !important;
        }
        
        /* Estilos para precios con descuento */
        .price-offer {
            color: #dc3545 !important;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- ============================================
        ARRA DE NAVEGACI√ìN PRINCIPAL
    ============================================ -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: #008c5a;">
        <div class="container-fluid">
            <!-- ============================================
                LOGO DE LA EMPRESA
            ============================================ -->
            <a class="navbar-brand fw-bold" href="index.html">EcoMarket</a>

            <!-- ============================================
                ICONOS DE USUARIO Y CARRITO
                (Siempre visibles en la parte derecha)
            ============================================ -->
            <div class="d-flex align-items-center gap-2 order-lg-3">
                
                <!-- Dropdown del Usuario -->
                <div class="dropdown">
                    <a href="#" class="text-white" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person fs-5"></i>
                    </a>
                    <!-- Men√∫ desplegable del usuario (contenido din√°mico v√≠a JS) -->
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown" id="userDropdownMenu">
                        <!-- El contenido se genera din√°micamente con JavaScript -->
                    </ul>
                </div>

                <!-- Enlace al Carrito de Compras -->
                <a href="carrito.html" class="text-white position-relative">
                    <i class="bi bi-cart fs-5"></i>
                    <!-- Contador de productos en el carrito (din√°mico) -->
                    <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                        0
                    </span>  
                </a>
            </div>

            <!-- ============================================
                BOT√ìN HAMBURGUESA PARA M√ìVIL
            ============================================ -->
            <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="custom-toggler-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>

            <!-- ============================================
                MEN√ö DE NAVEGACI√ìN PRINCIPAL
            ============================================ -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="catalogo.html">Cat√°logo</a></li>
                    <li class="nav-item"><a class="nav-link" href="nosotros.html">Nosotros</a></li>
                    <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ============================================
        CARRUSEL PRINCIPAL DE IM√ÅGENES
    ============================================ -->
    <section id="hero" class="mb-5">
        <div id="carouselEcoMarket" class="carousel slide" data-bs-ride="carousel">
            
            <!-- ============================================
                INDICADORES DEL CARRUSEL
            ============================================ -->
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>

            <!-- ============================================
                SLIDES DEL CARRUSEL
            ============================================ -->
            <div class="carousel-inner">
                
                <!-- Slide 1: Frutas Frescas -->
                <div class="carousel-item active">
                    <img src="assets/img/banner1.jpg" class="d-block w-100" alt="Frutas frescas">
                    <div class="carousel-caption d-none d-md-block">
                        <h2>Frutas frescas directo del campo</h2>
                        <p>Compra online y recibe en tu casa el mismo d√≠a</p>
                    </div>
                </div>
                
                <!-- Slide 2: Verduras Org√°nicas -->
                <div class="carousel-item">
                    <img src="assets/img/banner2.jpg" class="d-block w-100" alt="Verduras org√°nicas">
                    <div class="carousel-caption d-none d-md-block">
                        <h2>Verduras 100% org√°nicas</h2>
                        <p>Sin qu√≠micos, frescas y saludables</p>
                    </div>
                </div>
                
                <!-- Slide 3: Apoyo Local -->
                <div class="carousel-item">
                    <img src="assets/img/banner3.jpg" class="d-block w-100" alt="Apoyo local">
                    <div class="carousel-caption d-none d-md-block">
                        <h2>Apoya a los agricultores locales</h2>
                        <p>EcoMarket conecta productores con tu mesa</p>
                    </div>
                </div>
            </div>

            <!-- ============================================
                CONTROLES DE NAVEGACI√ìN DEL CARRUSEL
            ============================================ -->
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselEcoMarket" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselEcoMarket" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Siguiente</span>
            </button>
        </div>
    </section>

    <!-- ============================================
        SECCI√ìN DE CATEGOR√çAS RECOMENDADAS
    ============================================ -->
    <section class="container my-5">
        <h2 class="text-center mb-4">Explora por categor√≠as</h2>
        
        <div class="row g-4">
            <!-- ============================================
                CATEGOR√çA: FRUTAS
            ============================================ -->
            <div class="col-lg-3 col-md-6 col-12">
                <a href="catalogo.html?categoria=frutas" class="category-card">
                    <img src="assets/img/frutas.png" alt="Frutas" class="img-fluid rounded shadow">
                    <div class="category-overlay">Frutas</div>
                </a>
            </div>
            
            <!-- ============================================
                CATEGOR√çA: VERDURAS
            ============================================ -->
            <div class="col-lg-3 col-md-6 col-12">
                <a href="catalogo.html?categoria=verduras" class="category-card">
                    <img src="assets/img/verduras.png" alt="Verduras" class="img-fluid rounded shadow">
                    <div class="category-overlay">Verduras</div>
                </a>
            </div>
            
            <!-- ============================================
                CATEGOR√çA: DESPENSA
            ============================================ -->
            <div class="col-lg-3 col-md-6 col-12">
                <a href="catalogo.html?categoria=despensa" class="category-card">
                    <img src="assets/img/despensa.png" alt="Despensa" class="img-fluid rounded shadow">
                    <div class="category-overlay">Despensa</div>
                </a>
            </div>
            
            <!-- ============================================
                CATEGOR√çA: OFERTAS ESPECIALES
            ============================================ -->
            <div class="col-lg-3 col-md-6 col-12">
                <a href="catalogo.html?categoria=ofertas" class="category-card">
                    <img src="assets/img/ofertas.png" alt="Ofertas" class="img-fluid rounded shadow">
                    <div class="category-overlay">Ofertas</div>
                </a>
            </div>
        </div>
    </section>




    <!-- ============================================
        SECCI√ìN HERO PROMOCIONAL
    ============================================ -->
    <section class="hero d-flex align-items-center text-center text-white">
        <div class="container">
            <h1 class="h2 fw-light">Frutas y verduras frescas directo a tu mesa</h1>
            <p class="lead">Compra online y recibe en tu casa el mismo d√≠a</p>
            <a href="catalogo.html" class="btn btn-success btn-lg mt-3">Explorar cat√°logo</a>
        </div>
    </section>

    <!-- ============================================
        SECCI√ìN DE BENEFICIOS DE ECOMARKET
    ============================================ -->
    <section class="py-5 bg-light text-center">
        <div class="container">
            <h2 class="mb-5">¬øPor qu√© elegir EcoMarket?</h2>
            
            <div class="row g-4">
                <!-- ============================================
                    BENEFICIO: PRODUCTOS ORG√ÅNICOS
                ============================================ -->
                <div class="col-md-4">
                    <i class="bi bi-leaf fs-1 text-success"></i>
                    <h5 class="mt-3">Org√°nico</h5>
                    <p>Frutas y verduras libres de qu√≠micos, frescas y saludables.</p>
                </div>
                
                <!-- ============================================
                    BENEFICIO: ENTREGA R√ÅPIDA
                ============================================ -->
                <div class="col-md-4">
                    <i class="bi bi-truck fs-1 text-success"></i>
                    <h5 class="mt-3">Entrega r√°pida</h5>
                    <p>Recibe tus compras el mismo d√≠a en la puerta de tu casa.</p>
                </div>
                
                <!-- ============================================
                    BENEFICIO: APOYO A PRODUCTORES LOCALES
                ============================================ -->
                <div class="col-md-4">
                    <i class="bi bi-people fs-1 text-success"></i>
                    <h5 class="mt-3">Apoyo local</h5>
                    <p>Apoyas a agricultores de tu zona comprando en EcoMarket.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- PRODUCTOS DESTACADOS -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2 class="mb-0">Productos destacados</h2>
                <button id="refreshFeaturedBtn" class="btn btn-outline-success btn-sm" onclick="refreshFeaturedProducts()">
                    <i class="bi bi-arrow-clockwise me-1"></i>
                    Ver otros productos
                </button>
            </div>
            <div class="row g-4" id="featured-products">
                <!-- Los productos se cargar√°n din√°micamente -->
            </div>
            
            <!-- Enlace al cat√°logo completo -->
            <div class="text-center mt-5">
                <a href="catalogo.html" class="btn btn-outline-success btn-lg">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Ver cat√°logo completo
                </a>
            </div>
        </div>
    </section>

    <!-- Incluir catalog.js para funciones de productos -->
    <script src="assets/js/catalog.js"></script>
    
    <script>
        // IDs de productos destacados (se tomar√°n del sistema real de productos)
        // Funci√≥n para seleccionar productos destacados aleatoriamente con prioridades
        function getFeaturedProducts() {
            // Obtener todos los productos disponibles
            const allProducts = getProducts();
            
            // Filtrar solo productos que tengan stock y est√©n disponibles
            const availableProducts = allProducts.filter(product => 
                product.available !== false && product.stock > 0
            );
            
            // Crear arrays de prioridad
            const highPriority = []; // Ofertas y productos nuevos
            const normalPriority = []; // Productos regulares
            
            availableProducts.forEach(product => {
                if (product.isOffer || product.isNew) {
                    highPriority.push(product);
                } else {
                    normalPriority.push(product);
                }
            });
            
            // Mezclar ambos arrays aleatoriamente
            const shuffleArray = (array) => {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            };
            
            const shuffledHigh = shuffleArray(highPriority);
            const shuffledNormal = shuffleArray(normalPriority);
            
            // Seleccionar productos: priorizar ofertas/nuevos pero incluir productos normales
            const selectedProducts = [];
            const targetCount = 4;
            
            // Tomar hasta 2 productos de alta prioridad
            const highCount = Math.min(2, shuffledHigh.length);
            selectedProducts.push(...shuffledHigh.slice(0, highCount));
            
            // Completar con productos normales hasta llegar a 4
            const remainingCount = targetCount - selectedProducts.length;
            if (remainingCount > 0) {
                selectedProducts.push(...shuffledNormal.slice(0, remainingCount));
            }
            
            // Si no hay suficientes productos normales, usar m√°s de alta prioridad
            if (selectedProducts.length < targetCount && shuffledHigh.length > highCount) {
                const extraHighCount = Math.min(targetCount - selectedProducts.length, shuffledHigh.length - highCount);
                selectedProducts.push(...shuffledHigh.slice(highCount, highCount + extraHighCount));
            }
            
            // Mezclar la selecci√≥n final para que no siempre aparezcan en el mismo orden
            const finalSelection = shuffleArray(selectedProducts);
            
            console.log('üé≤ Productos destacados seleccionados:', finalSelection.map(p => `${p.name} ${p.isOffer ? '(OFERTA)' : ''} ${p.isNew ? '(NUEVO)' : ''}`));
            
            return finalSelection;
        }

        // Funci√≥n para renderizar productos destacados
        function renderFeaturedProducts() {
            const container = document.getElementById('featured-products');
            const featuredProducts = getFeaturedProducts();
            
            if (featuredProducts.length === 0) {
                container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">No hay productos destacados disponibles</p></div>';
                return;
            }
            
            const productsHTML = featuredProducts.map(product => {
                // Determinar estado del producto usando datos reales
                let statusBadges = [];
                let buttonContent = '';
                let buttonClass = 'btn btn-success btn-sm';
                let buttonAction = `addToCartFromFeatured('${product.id}')`;

                // Badge de oferta (prioridad m√°xima)
                if (product.isOffer && product.originalPrice) {
                    const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                    statusBadges.push(`<span class="badge offer-badge position-absolute top-0 start-0 m-2" style="z-index: 10;">-${discountPercent}% OFF</span>`);
                }

                // Badge de stock
                if (!product.available || product.stock === 0) {
                    statusBadges.push('<span class="badge bg-danger position-absolute top-0 end-0 m-2">Sin stock</span>');
                    buttonContent = '<i class="bi bi-x-circle me-1"></i>No disponible';
                    buttonClass = 'btn btn-secondary btn-sm';
                    buttonAction = `showNotAvailable('${product.name}')`;
                } else if (product.stock <= 5) {
                    statusBadges.push('<span class="badge bg-warning position-absolute top-0 end-0 m-2">¬°√öltimas unidades!</span>');
                    buttonContent = '<i class="bi bi-cart-plus me-1"></i>Agregar';
                } else {
                    buttonContent = '<i class="bi bi-cart-plus me-1"></i>Agregar';
                }

                const statusBadgesHTML = statusBadges.join('');

                return `
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="card h-100 shadow-sm position-relative featured-product-card">
                            ${statusBadgesHTML}
                            <img src="${product.image}" class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name}</h5>
                                <p class="card-text text-muted small flex-grow-1">${product.description}</p>
                                
                                <div class="mt-auto">
                                    <div class="mb-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                ${product.isOffer && product.originalPrice ? 
                                                    `<div><span class="price-original text-decoration-line-through">$${product.originalPrice.toLocaleString()}</span></div>
                                                    <div><span class="price-offer fs-5">$${product.price.toLocaleString()}</span></div>` 
                                                    : 
                                                    `<span class="fw-bold text-success fs-5">$${product.price.toLocaleString()}</span>`
                                                }
                                            </div>
                                            <small class="text-muted">por ${product.unit}</small>
                                        </div>
                                    </div>
                                    
                                    ${product.available && product.stock > 0 ? `
                                        <div class="text-center mb-2">
                                            <small class="text-success">
                                                <i class="bi bi-check-circle me-1"></i>
                                                ${product.stock} disponibles
                                            </small>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="d-grid">
                                        <button class="${buttonClass}" onclick="${buttonAction}">
                                            ${buttonContent}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = productsHTML;
        }

        // Funci√≥n para refrescar productos destacados manualmente
        function refreshFeaturedProducts() {
            console.log('üîÑ Refrescando productos destacados...');
            
            // Agregar animaci√≥n al bot√≥n
            const refreshBtn = document.getElementById('refreshFeaturedBtn');
            const originalHTML = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise me-1 spinner-border spinner-border-sm" role="status"></i> Cargando...';
            refreshBtn.disabled = true;
            
            // Agregar un peque√±o delay para mostrar la animaci√≥n
            setTimeout(() => {
                renderFeaturedProducts();
                
                // Restaurar el bot√≥n
                refreshBtn.innerHTML = originalHTML;
                refreshBtn.disabled = false;
                
                // Mostrar notificaci√≥n
                if (typeof showNotificationLocal === 'function') {
                    showNotificationLocal('¬°Productos actualizados!', 'success', 2000);
                }
            }, 300);
        }

        // Funci√≥n para agregar al carrito desde productos destacados (implementaci√≥n independiente)
        function addToCartFromFeatured(productId) {
            try {
                console.log('Intentando agregar producto al carrito:', productId);
                
                // Obtener productos usando la funci√≥n global y asegurar que est√©n inicializados
                let products = [];
                if (typeof getProducts === 'function') {
                    products = getProducts();
                } else {
                    // Fallback: cargar directamente desde localStorage
                    const savedProducts = localStorage.getItem('ecomarket_products');
                    products = savedProducts ? JSON.parse(savedProducts) : [];
                }
                
                console.log('üìã Productos disponibles:', products.length);
                const product = products.find(p => p.id === productId);
                console.log('üéØ Producto encontrado:', product);
                
                if (!product) {
                    console.error('‚ùå Producto no encontrado con ID:', productId);
                    console.log('üìã Productos disponibles:', products.map(p => ({id: p.id, name: p.name})));
                    showNotificationLocal('Producto no encontrado', 'error');
                    return;
                }
                
                if (product.stock <= 0) {
                    showNotificationLocal(`${product.name} no tiene stock disponible`, 'warning');
                    return;
                }
                
                // Obtener carrito actual
                let cart = JSON.parse(localStorage.getItem('ecomarket_cart')) || [];
                
                // Buscar si el producto ya est√° en el carrito
                const existingItem = cart.find(item => item.productId === productId);
                
                if (existingItem) {
                    // Verificar si podemos agregar m√°s
                    if (existingItem.quantity >= product.stock) {
                        showNotificationLocal(`Ya tienes el m√°ximo disponible de ${product.name} en tu carrito`, 'warning');
                        return;
                    }
                    // Aumentar cantidad
                    existingItem.quantity += 1;
                } else {
                    // Agregar nuevo producto al carrito
                    cart.push({
                        productId: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        quantity: 1,
                        unit: product.unit || 'unidad'
                    });
                }
                
                // Guardar carrito actualizado
                localStorage.setItem('ecomarket_cart', JSON.stringify(cart));
                console.log('üíæ Carrito guardado en localStorage:', cart);
                console.log('üîó Estructura del carrito:', JSON.stringify(cart, null, 2));
                
                // Reducir stock del producto
                product.stock -= 1;
                localStorage.setItem('ecomarket_products', JSON.stringify(products));
                
                // Mostrar notificaci√≥n de √©xito
                showNotificationLocal(`¬°${product.name} agregado al carrito!`, 'success');
                
                // Actualizar contador del carrito si existe
                if (typeof updateCartCounter === 'function') {
                    updateCartCounter();
                }
                
                // Actualizar la vista de productos destacados para reflejar cambios de stock
                setTimeout(() => {
                    renderFeaturedProducts();
                }, 300);
                
            } catch (error) {
                console.error('Error al agregar producto al carrito:', error);
                showNotificationLocal('Error al agregar el producto al carrito', 'error');
            }
        }

        // Funci√≥n para actualizar contador del carrito
        function updateCartCounter() {
            try {
                const cart = JSON.parse(localStorage.getItem('ecomarket_cart')) || [];
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                
                // Buscar el contador en el navbar
                const cartBadge = document.querySelector('.cart-count, #cart-count, .badge');
                if (cartBadge) {
                    cartBadge.textContent = totalItems;
                    cartBadge.style.display = totalItems > 0 ? 'inline-block' : 'none';
                }
            } catch (error) {
                console.error('Error al actualizar contador del carrito:', error);
            }
        }

        // Funci√≥n para mostrar mensaje de no disponible
        function showNotAvailable(productName) {
            if (typeof showToast === 'function') {
                showToast(`${productName} no est√° disponible en este momento`, 'info');
            } else {
                showNotificationLocal(`${productName} no est√° disponible en este momento`, 'info');
            }
        }

        // Funci√≥n para mostrar notificaciones (usar la de app.js si existe)
        function showNotificationLocal(message, type = 'success', duration = 4000) {
            // Si existe la funci√≥n global de app.js, usarla
            if (typeof window.showNotification === 'function') {
                window.showNotification(message, type, duration);
                return;
            }

            // Fallback: notificaci√≥n simple pero m√°s visible
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} position-fixed shadow-lg`;
            notification.style.cssText = `
                top: 20px; 
                right: 20px; 
                z-index: 9999; 
                min-width: 300px;
                max-width: 400px;
                opacity: 0.95;
                border: none;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease-out;
            `;
            notification.innerHTML = `
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-${type === 'success' ? 'check-circle-fill' : type === 'error' ? 'x-circle-fill' : type === 'warning' ? 'exclamation-triangle-fill' : 'info-circle-fill'} me-2 fs-5"></i>
                        <span style="font-weight: 500;">${message}</span>
                    </div>
                    <button type="button" class="btn-close btn-close-sm ms-2" aria-label="Cerrar" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            // Agregar estilos de animaci√≥n si no existen
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.innerHTML = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 0.95; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 0.95; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    // Animaci√≥n de salida
                    notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, duration);
        }

        // Funci√≥n para actualizar contador del carrito
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('ecomarket_cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountElement = document.getElementById('cart-count');
            
            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
                cartCountElement.style.display = totalItems > 0 ? 'block' : 'none';
            }
        }

        // Funci√≥n para inicializar productos si no existen
        function initializeProducts() {
            // Verificar si hay productos en localStorage
            const existingProducts = localStorage.getItem('ecomarket_products');
            if (!existingProducts || existingProducts === '[]') {
                console.log('üîß Inicializando productos por defecto...');
                // Usar la funci√≥n de catalog.js si est√° disponible
                if (typeof getProducts === 'function') {
                    const products = getProducts(); // Esto deber√≠a devolver defaultProducts si no hay productos
                    localStorage.setItem('ecomarket_products', JSON.stringify(products));
                    console.log('‚úÖ Productos inicializados:', products.length, 'productos');
                } else {
                    console.warn('‚ö†Ô∏è getProducts no est√° disponible, productos no inicializados');
                }
            } else {
                console.log('‚úÖ Productos ya existen en localStorage');
            }
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar productos si no existen
            initializeProducts();
            
            // Renderizar productos destacados
            renderFeaturedProducts();
            
            // Actualizar contador del carrito
            updateCartCount();
        });

        // Escuchar cambios en los productos desde el admin
        window.addEventListener('productsUpdated', function(event) {
            console.log('Productos actualizados desde admin, recargando productos destacados');
            renderFeaturedProducts();
        });

        // Escuchar cambios en el localStorage de productos (si se actualiza desde otra pesta√±a)
        window.addEventListener('storage', function(event) {
            if (event.key === 'ecomarket_products') {
                console.log('Productos actualizados en localStorage, recargando productos destacados');
                renderFeaturedProducts();
            }
        });
    </script>    <!-- Footer Container -->
    <div id="footer-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/footer.js"></script>
    
    <script>
        // Asegurar que el dropdown del usuario se actualice correctamente
        document.addEventListener('DOMContentLoaded', function() {
            // Esperar un momento para que app.js se cargue completamente
            setTimeout(function() {
                if (typeof updateNavbar === 'function') {
                    updateNavbar();
                } else if (typeof updateUserDropdown === 'function') {
                    updateUserDropdown();
                }
            }, 200);
        });
        
        // Footer inline como backup
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('footer-container');
            if (container && !container.innerHTML.trim()) {
                console.log('üîß Cargando footer inline como backup...');
                container.innerHTML = `
                <footer class="footer">
                    <div class="footer-top">
                        <p>¬øTe queda alguna duda? Capaz que esta informaci√≥n te sirva ;)</p>
                    </div>
                    <div class="footer-content">
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('pasillos')">
                                PASILLOS <i class="bi bi-chevron-down accordion-icon" id="pasillos-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="pasillos-content">
                                <li><a href="catalogo.html?categoria=frutas">Frutas</a></li>
                                <li><a href="catalogo.html?categoria=verduras">Verduras</a></li>
                                <li><a href="catalogo.html?categoria=despensa">Despensa</a></li>
                                <li><a href="catalogo.html?categoria=ofertas">Ofertas</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('paginas')">
                                P√ÅGINAS <i class="bi bi-chevron-down accordion-icon" id="paginas-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="paginas-content">
                                <li><a href="index.html">Inicio</a></li>
                                <li><a href="catalogo.html">Cat√°logo</a></li>
                                <li><a href="carrito.html">Carrito</a></li>
                                <li><a href="login.html">Mi cuenta</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('contacto')">
                                CONTACTO <i class="bi bi-chevron-down accordion-icon" id="contacto-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="contacto-content">
                                <li><a href="tel:+573001234567">üìû +57 300 123 4567</a></li>
                                <li><a href="mailto:info@ecomarket.com">‚úâÔ∏è info@ecomarket.com</a></li>
                                <li><a href="#">üìç Calle 123 #45-67, Ciudad</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('politicas')">
                                POL√çTICAS <i class="bi bi-chevron-down accordion-icon" id="politicas-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="politicas-content">
                                <li><a href="#">T√©rminos y condiciones</a></li>
                                <li><a href="#">Pol√≠tica de privacidad</a></li>
                                <li><a href="#">Pol√≠tica de devoluciones</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-divider"></div>
                    <div class="footer-bottom">
                        <p>&copy; 2024 EcoMarket. Todos los derechos reservados. | Frutas y verduras frescas para tu mesa</p>
                    </div>
                </footer>
                `;
                console.log('‚úÖ Footer inline cargado exitosamente');
            }
        });
    </script>
    </body>
</html>
